<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>CellSync - Full CRUD Test</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            body {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                padding: 20px;
            }
            .container {
                max-width: 1200px;
                margin: 0 auto;
            }
            .header {
                text-align: center;
                color: white;
                margin-bottom: 30px;
            }
            .header h1 {
                font-size: 3em;
                margin-bottom: 10px;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }
            .header p {
                font-size: 1.2em;
                opacity: 0.9;
            }
            .tabs {
                display: flex;
                gap: 10px;
                margin-bottom: 20px;
                flex-wrap: wrap;
            }
            .tab {
                flex: 1;
                min-width: 150px;
                padding: 15px 20px;
                background: rgba(255, 255, 255, 0.2);
                border: none;
                color: white;
                font-size: 16px;
                font-weight: bold;
                cursor: pointer;
                border-radius: 8px;
                transition: all 0.3s;
            }
            .tab:hover {
                background: rgba(255, 255, 255, 0.3);
                transform: translateY(-2px);
            }
            .tab.active {
                background: white;
                color: #667eea;
            }
            .content {
                background: white;
                padding: 30px;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            }
            .tab-content {
                display: none;
            }
            .tab-content.active {
                display: block;
            }
            h2 {
                color: #667eea;
                margin-bottom: 20px;
                padding-bottom: 10px;
                border-bottom: 3px solid #667eea;
            }
            .form-group {
                margin-bottom: 20px;
            }
            label {
                display: block;
                margin-bottom: 8px;
                font-weight: 600;
                color: #333;
            }
            input,
            select {
                width: 100%;
                padding: 12px;
                border: 2px solid #e0e0e0;
                border-radius: 6px;
                font-size: 15px;
                transition: border-color 0.3s;
            }
            input:focus,
            select:focus {
                outline: none;
                border-color: #667eea;
            }
            button {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 14px 30px;
                border: none;
                border-radius: 6px;
                cursor: pointer;
                font-size: 16px;
                font-weight: bold;
                transition:
                    transform 0.2s,
                    box-shadow 0.2s;
            }
            button:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            }
            button:active {
                transform: translateY(0);
            }
            .btn-danger {
                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            }
            .btn-warning {
                background: linear-gradient(135deg, #ffd89b 0%, #ff6f61 100%);
            }
            .btn-success {
                background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            }
            .response {
                margin-top: 20px;
                padding: 15px;
                border-radius: 6px;
                display: none;
                animation: slideIn 0.3s;
            }
            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            .response.success {
                background-color: #d4edda;
                border: 2px solid #c3e6cb;
                color: #155724;
            }
            .response.error {
                background-color: #f8d7da;
                border: 2px solid #f5c6cb;
                color: #721c24;
            }
            .phone-list {
                margin-top: 20px;
            }
            .phone-card {
                background: #f8f9fa;
                padding: 20px;
                margin-bottom: 15px;
                border-radius: 8px;
                border-left: 4px solid #667eea;
                display: flex;
                justify-content: space-between;
                align-items: center;
                transition: transform 0.2s;
            }
            .phone-card:hover {
                transform: translateX(5px);
                box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            }
            .phone-info {
                flex: 1;
            }
            .phone-info h3 {
                color: #333;
                margin-bottom: 8px;
            }
            .phone-info p {
                color: #666;
                margin: 4px 0;
            }
            .phone-actions {
                display: flex;
                gap: 10px;
            }
            .phone-actions button {
                padding: 8px 16px;
                font-size: 14px;
            }
            .links {
                margin-top: 30px;
                padding: 20px;
                background: #f8f9fa;
                border-radius: 8px;
            }
            .links h3 {
                color: #667eea;
                margin-bottom: 15px;
            }
            .links a {
                display: block;
                margin: 10px 0;
                color: #667eea;
                text-decoration: none;
                padding: 12px;
                background: white;
                border-radius: 6px;
                border: 2px solid #e0e0e0;
                transition: all 0.3s;
            }
            .links a:hover {
                border-color: #667eea;
                transform: translateX(5px);
            }
            .search-filters {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin-bottom: 20px;
            }
            .loader {
                border: 4px solid #f3f3f3;
                border-top: 4px solid #667eea;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                animation: spin 1s linear infinite;
                margin: 20px auto;
                display: none;
            }
            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>üì± CellSync CRUD Manager</h1>
                <p>Complete Create, Read, Update, Delete Operations</p>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="showTab('create')">
                    ‚ûï Create
                </button>
                <button class="tab" onclick="showTab('read')">
                    üìã Read All
                </button>
                <button class="tab" onclick="showTab('search')">
                    üîç Search
                </button>
                <button class="tab" onclick="showTab('update')">
                    ‚úèÔ∏è Update
                </button>
                <button class="tab" onclick="showTab('delete')">
                    üóëÔ∏è Delete
                </button>
                <button class="tab" onclick="showTab('api')">
                    üîó API Docs
                </button>
            </div>

            <div class="content">
                <!-- CREATE TAB -->
                <div id="create" class="tab-content active">
                    <h2>‚ûï Create New Phone</h2>
                    <form id="createForm">
                        <div class="form-group">
                            <label for="create_name">Phone Name:</label>
                            <input
                                type="text"
                                id="create_name"
                                required
                                placeholder="e.g., iPhone 15 Plus"
                            />
                        </div>
                        <div class="form-group">
                            <label for="create_brand">Brand:</label>
                            <input
                                type="text"
                                id="create_brand"
                                required
                                placeholder="e.g., Apple"
                            />
                        </div>
                        <div class="form-group">
                            <label for="create_price">Price ($):</label>
                            <input
                                type="number"
                                id="create_price"
                                step="0.01"
                                required
                                placeholder="e.g., 899.99"
                            />
                        </div>
                        <div class="form-group">
                            <label for="create_stock">Stock Quantity:</label>
                            <input
                                type="number"
                                id="create_stock"
                                required
                                placeholder="e.g., 15"
                            />
                        </div>
                        <div class="form-group">
                            <label for="create_color">Color:</label>
                            <input
                                type="text"
                                id="create_color"
                                required
                                placeholder="e.g., Blue"
                            />
                        </div>
                        <div class="form-group">
                            <label for="create_storage">Storage:</label>
                            <input
                                type="text"
                                id="create_storage"
                                required
                                placeholder="e.g., 256GB"
                            />
                        </div>
                        <button type="submit">Add Phone</button>
                    </form>
                    <div id="create_response" class="response"></div>
                </div>

                <!-- READ ALL TAB -->
                <div id="read" class="tab-content">
                    <h2>üìã All Phones</h2>
                    <button onclick="loadAllPhones()" class="btn-success">
                        üîÑ Refresh List
                    </button>
                    <div class="loader" id="read_loader"></div>
                    <div id="phones_list" class="phone-list"></div>
                    <div id="read_response" class="response"></div>
                </div>

                <!-- SEARCH TAB -->
                <div id="search" class="tab-content">
                    <h2>üîç Search Phones</h2>
                    <form id="searchForm">
                        <div class="search-filters">
                            <div class="form-group">
                                <label for="search_brand">Brand:</label>
                                <input
                                    type="text"
                                    id="search_brand"
                                    placeholder="e.g., Apple"
                                />
                            </div>
                            <div class="form-group">
                                <label for="search_minPrice">Min Price:</label>
                                <input
                                    type="number"
                                    id="search_minPrice"
                                    step="0.01"
                                    placeholder="e.g., 500"
                                />
                            </div>
                            <div class="form-group">
                                <label for="search_maxPrice">Max Price:</label>
                                <input
                                    type="number"
                                    id="search_maxPrice"
                                    step="0.01"
                                    placeholder="e.g., 1000"
                                />
                            </div>
                            <div class="form-group">
                                <label for="search_storage">Storage:</label>
                                <input
                                    type="text"
                                    id="search_storage"
                                    placeholder="e.g., 256GB"
                                />
                            </div>
                        </div>
                        <button type="submit">Search</button>
                    </form>
                    <div class="loader" id="search_loader"></div>
                    <div id="search_results" class="phone-list"></div>
                    <div id="search_response" class="response"></div>
                </div>

                <!-- UPDATE TAB -->
                <div id="update" class="tab-content">
                    <h2>‚úèÔ∏è Update Phone</h2>
                    <div class="form-group">
                        <label for="update_id">Phone ID:</label>
                        <input
                            type="number"
                            id="update_id"
                            required
                            placeholder="Enter phone ID"
                        />
                        <button
                            onclick="loadPhoneForUpdate()"
                            style="margin-top: 10px"
                            class="btn-warning"
                        >
                            Load Phone Data
                        </button>
                    </div>
                    <div class="loader" id="update_loader"></div>
                    <form id="updateForm" style="display: none">
                        <div class="form-group">
                            <label for="update_name">Phone Name:</label>
                            <input type="text" id="update_name" required />
                        </div>
                        <div class="form-group">
                            <label for="update_brand">Brand:</label>
                            <input type="text" id="update_brand" required />
                        </div>
                        <div class="form-group">
                            <label for="update_price">Price ($):</label>
                            <input
                                type="number"
                                id="update_price"
                                step="0.01"
                                required
                            />
                        </div>
                        <div class="form-group">
                            <label for="update_stock">Stock Quantity:</label>
                            <input type="number" id="update_stock" required />
                        </div>
                        <div class="form-group">
                            <label for="update_color">Color:</label>
                            <input type="text" id="update_color" required />
                        </div>
                        <div class="form-group">
                            <label for="update_storage">Storage:</label>
                            <input type="text" id="update_storage" required />
                        </div>
                        <button type="submit">Update Phone</button>
                    </form>
                    <div id="update_response" class="response"></div>
                </div>

                <!-- DELETE TAB -->
                <div id="delete" class="tab-content">
                    <h2>üóëÔ∏è Delete Phone</h2>
                    <div class="form-group">
                        <label for="delete_id">Phone ID:</label>
                        <input
                            type="number"
                            id="delete_id"
                            required
                            placeholder="Enter phone ID to delete"
                        />
                        <button
                            onclick="loadPhoneForDelete()"
                            style="margin-top: 10px"
                            class="btn-warning"
                        >
                            Preview Phone
                        </button>
                    </div>
                    <div class="loader" id="delete_loader"></div>
                    <div id="delete_preview"></div>
                    <div id="delete_response" class="response"></div>
                </div>

                <!-- API DOCS TAB -->
                <div id="api" class="tab-content">
                    <h2>üîó API Documentation</h2>
                    <div class="links">
                        <h3>üìã READ Operations</h3>
                        <a href="/phones" target="_blank"
                            >GET /phones - Get all phones</a
                        >
                        <a href="/phones/1" target="_blank"
                            >GET /phones/:id - Get phone by ID (example: ID
                            1)</a
                        >
                        <a href="/phones/search?brand=Apple" target="_blank"
                            >GET /phones/search?brand=Apple - Search by brand</a
                        >
                        <a
                            href="/phones/search?minPrice=500&maxPrice=800"
                            target="_blank"
                            >GET /phones/search?minPrice=500&maxPrice=800 -
                            Search by price range</a
                        >
                        <a href="/phones/search?storage=256GB" target="_blank"
                            >GET /phones/search?storage=256GB - Search by
                            storage</a
                        >

                        <h3 style="margin-top: 20px">‚ûï CREATE Operation</h3>
                        <p
                            style="
                                padding: 12px;
                                background: white;
                                border-radius: 6px;
                                border: 2px solid #e0e0e0;
                                color: #333;
                            "
                        >
                            <strong>POST /phones/insert</strong><br />
                            Body: {"name": "...", "brand": "...", "price":
                            899.99, "stock_quantity": 15, "color": "...",
                            "storage": "..."}
                        </p>

                        <h3 style="margin-top: 20px">‚úèÔ∏è UPDATE Operation</h3>
                        <p
                            style="
                                padding: 12px;
                                background: white;
                                border-radius: 6px;
                                border: 2px solid #e0e0e0;
                                color: #333;
                            "
                        >
                            <strong>PUT /phones/:id</strong><br />
                            Body: {"name": "...", "brand": "...", "price":
                            899.99, "stock_quantity": 15, "color": "...",
                            "storage": "..."}
                        </p>

                        <h3 style="margin-top: 20px">üóëÔ∏è DELETE Operation</h3>
                        <p
                            style="
                                padding: 12px;
                                background: white;
                                border-radius: 6px;
                                border: 2px solid #e0e0e0;
                                color: #333;
                            "
                        >
                            <strong>DELETE /phones/:id</strong>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Tab switching
            function showTab(tabName) {
                document.querySelectorAll(".tab-content").forEach((content) => {
                    content.classList.remove("active");
                });
                document.querySelectorAll(".tab").forEach((tab) => {
                    tab.classList.remove("active");
                });
                document.getElementById(tabName).classList.add("active");
                event.target.classList.add("active");

                // Auto-load data for read tab
                if (tabName === "read") {
                    loadAllPhones();
                }
            }

            // Helper function to show response
            function showResponse(elementId, message, isSuccess) {
                const responseDiv = document.getElementById(elementId);
                responseDiv.className = `response ${isSuccess ? "success" : "error"}`;
                responseDiv.innerHTML = `<strong>${isSuccess ? "Success!" : "Error!"}</strong> ${message}`;
                responseDiv.style.display = "block";
                setTimeout(() => {
                    responseDiv.style.display = "none";
                }, 5000);
            }

            // CREATE - Insert new phone
            document
                .getElementById("createForm")
                .addEventListener("submit", async (e) => {
                    e.preventDefault();
                    const formData = {
                        name: document.getElementById("create_name").value,
                        brand: document.getElementById("create_brand").value,
                        price: parseFloat(
                            document.getElementById("create_price").value,
                        ),
                        stock_quantity: parseInt(
                            document.getElementById("create_stock").value,
                        ),
                        color: document.getElementById("create_color").value,
                        storage:
                            document.getElementById("create_storage").value,
                    };

                    try {
                        const response = await fetch("/phones/insert", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(formData),
                        });
                        const result = await response.text();
                        showResponse("create_response", result, response.ok);
                        if (response.ok) {
                            document.getElementById("createForm").reset();
                        }
                    } catch (error) {
                        showResponse("create_response", error.message, false);
                    }
                });

            // READ - Load all phones
            async function loadAllPhones() {
                const loader = document.getElementById("read_loader");
                const listDiv = document.getElementById("phones_list");

                loader.style.display = "block";
                listDiv.innerHTML = "";

                try {
                    const response = await fetch("/phones");
                    const text = await response.text();

                    // Try to parse as JSON
                    try {
                        const phones = JSON.parse(text);
                        if (phones.length === 0) {
                            listDiv.innerHTML =
                                '<p style="text-align: center; color: #999;">No phones found</p>';
                        } else {
                            listDiv.innerHTML = phones
                                .map(
                                    (phone) => `
                            <div class="phone-card">
                                <div class="phone-info">
                                    <h3>${phone.name}</h3>
                                    <p><strong>Brand:</strong> ${phone.brand} | <strong>Price:</strong> $${phone.price}</p>
                                    <p><strong>Storage:</strong> ${phone.storage} | <strong>Color:</strong> ${phone.color} | <strong>Stock:</strong> ${phone.stock_quantity}</p>
                                    <p style="font-size: 12px; color: #999;"><strong>ID:</strong> ${phone.id}</p>
                                </div>
                                <div class="phone-actions">
                                    <button class="btn-warning" onclick="editPhone(${phone.id})">Edit</button>
                                    <button class="btn-danger" onclick="quickDelete(${phone.id})">Delete</button>
                                </div>
                            </div>
                        `,
                                )
                                .join("");
                        }
                    } catch {
                        // If not JSON, display as HTML
                        listDiv.innerHTML = text;
                    }
                } catch (error) {
                    showResponse("read_response", error.message, false);
                } finally {
                    loader.style.display = "none";
                }
            }

            // SEARCH - Search phones
            document
                .getElementById("searchForm")
                .addEventListener("submit", async (e) => {
                    e.preventDefault();
                    const loader = document.getElementById("search_loader");
                    const resultsDiv =
                        document.getElementById("search_results");

                    const brand = document.getElementById("search_brand").value;
                    const minPrice =
                        document.getElementById("search_minPrice").value;
                    const maxPrice =
                        document.getElementById("search_maxPrice").value;
                    const storage =
                        document.getElementById("search_storage").value;

                    const params = new URLSearchParams();
                    if (brand) params.append("brand", brand);
                    if (minPrice) params.append("minPrice", minPrice);
                    if (maxPrice) params.append("maxPrice", maxPrice);
                    if (storage) params.append("storage", storage);

                    loader.style.display = "block";
                    resultsDiv.innerHTML = "";

                    try {
                        const response = await fetch(
                            `/phones/search?${params}`,
                        );
                        const text = await response.text();

                        try {
                            const phones = JSON.parse(text);
                            if (phones.length === 0) {
                                resultsDiv.innerHTML =
                                    '<p style="text-align: center; color: #999;">No phones found matching your criteria</p>';
                            } else {
                                resultsDiv.innerHTML =
                                    `<p style="margin-bottom: 15px; font-weight: bold;">Found ${phones.length} phone(s):</p>` +
                                    phones
                                        .map(
                                            (phone) => `
                            <div class="phone-card">
                                <div class="phone-info">
                                    <h3>${phone.name}</h3>
                                    <p><strong>Brand:</strong> ${phone.brand} | <strong>Price:</strong> $${phone.price}</p>
                                    <p><strong>Storage:</strong> ${phone.storage} | <strong>Color:</strong> ${phone.color} | <strong>Stock:</strong> ${phone.stock_quantity}</p>
                                    <p style="font-size: 12px; color: #999;"><strong>ID:</strong> ${phone.id}</p>
                                </div>
                            </div>
                        `,
                                        )
                                        .join("");
                            }
                        } catch {
                            resultsDiv.innerHTML = text;
                        }
                    } catch (error) {
                        showResponse("search_response", error.message, false);
                    } finally {
                        loader.style.display = "none";
                    }
                });

            // UPDATE - Load phone data
            async function loadPhoneForUpdate() {
                const id = document.getElementById("update_id").value;
                if (!id) {
                    showResponse(
                        "update_response",
                        "Please enter a phone ID",
                        false,
                    );
                    return;
                }

                const loader = document.getElementById("update_loader");
                loader.style.display = "block";

                try {
                    const response = await fetch(`/phones/${id}`);
                    if (!response.ok) {
                        throw new Error("Phone not found");
                    }
                    const phone = await response.json();

                    document.getElementById("update_name").value = phone.name;
                    document.getElementById("update_brand").value = phone.brand;
                    document.getElementById("update_price").value = phone.price;
                    document.getElementById("update_stock").value =
                        phone.stock_quantity;
                    document.getElementById("update_color").value = phone.color;
                    document.getElementById("update_storage").value =
                        phone.storage;

                    document.getElementById("updateForm").style.display =
                        "block";
                    showResponse(
                        "update_response",
                        "Phone data loaded successfully!",
                        true,
                    );
                } catch (error) {
                    showResponse("update_response", error.message, false);
                } finally {
                    loader.style.display = "none";
                }
            }

            // UPDATE - Submit update
            document
                .getElementById("updateForm")
                .addEventListener("submit", async (e) => {
                    e.preventDefault();
                    const id = document.getElementById("update_id").value;
                    const formData = {
                        name: document.getElementById("update_name").value,
                        brand: document.getElementById("update_brand").value,
                        price: parseFloat(
                            document.getElementById("update_price").value,
                        ),
                        stock_quantity: parseInt(
                            document.getElementById("update_stock").value,
                        ),
                        color: document.getElementById("update_color").value,
                        storage:
                            document.getElementById("update_storage").value,
                    };

                    try {
                        const response = await fetch(`/phones/${id}`, {
                            method: "PUT",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(formData),
                        });
                        const result = await response.json();
                        showResponse(
                            "update_response",
                            result.message || "Phone updated successfully!",
                            response.ok,
                        );
                    } catch (error) {
                        showResponse("update_response", error.message, false);
                    }
                });

            // DELETE - Load phone preview
            async function loadPhoneForDelete() {
                const id = document.getElementById("delete_id").value;
                if (!id) {
                    showResponse(
                        "delete_response",
                        "Please enter a phone ID",
                        false,
                    );
                    return;
                }

                const loader = document.getElementById("delete_loader");
                const previewDiv = document.getElementById("delete_preview");

                loader.style.display = "block";
                previewDiv.innerHTML = "";

                try {
                    const response = await fetch(`/phones/${id}`);
                    if (!response.ok) {
                        throw new Error("Phone not found");
                    }
                    const phone = await response.json();

                    previewDiv.innerHTML = `
                    <div class="phone-card" style="margin-top: 20px;">
                        <div class="phone-info">
                            <h3>${phone.name}</h3>
                            <p><strong>Brand:</strong> ${phone.brand} | <strong>Price:</strong> $${phone.price}</p>
                            <p><strong>Storage:</strong> ${phone.storage} | <strong>Color:</strong> ${phone.color} | <strong>Stock:</strong> ${phone.stock_quantity}</p>
                        </div>
                    </div>
                    <button onclick="confirmDelete(${id})" class="btn-danger" style="margin-top: 15px;">‚ö†Ô∏è Confirm Delete</button>
                `;
                } catch (error) {
                    showResponse("delete_response", error.message, false);
                } finally {
                    loader.style.display = "none";
                }
            }

            // DELETE - Confirm deletion
            async function confirmDelete(id) {
                if (!confirm("Are you sure you want to delete this phone?")) {
                    return;
                }

                try {
                    const response = await fetch(`/phones/${id}`, {
                        method: "DELETE",
                    });
                    const result = await response.json();
                    showResponse(
                        "delete_response",
                        result.message || "Phone deleted successfully!",
                        response.ok,
                    );
                    document.getElementById("delete_preview").innerHTML = "";
                    document.getElementById("delete_id").value = "";
                } catch (error) {
                    showResponse("delete_response", error.message, false);
                }
            }

            // Quick edit from Read tab
            function editPhone(id) {
                document.getElementById("update_id").value = id;
                showTab("update");
                document.querySelector(".tab:nth-child(4)").click();
                loadPhoneForUpdate();
            }

            // Quick delete from Read tab
            async function quickDelete(id) {
                if (!confirm("Are you sure you want to delete this phone?")) {
                    return;
                }

                try {
                    const response = await fetch(`/phones/${id}`, {
                        method: "DELETE",
                    });
                    const result = await response.json();
                    showResponse(
                        "read_response",
                        result.message || "Phone deleted successfully!",
                        response.ok,
                    );
                    loadAllPhones(); // Refresh the list
                } catch (error) {
                    showResponse("read_response", error.message, false);
                }
            }
        </script>
    </body>
</html>
